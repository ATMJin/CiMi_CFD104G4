<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™¼è¡¨æ–‡ç«  | CiMiäº¤å‹è«–å£‡</title>
    <link rel="icon" href="assets/images/logo.ico" type="image/x-icon">
    <link rel="stylesheet" href="assets/css/post.css">
    <link rel="stylesheet" href="assets/css/tabs.css">
</head>



<body>
    <header class="top_bar_box">
        <div class="top_bar">
            <div class="logo_box">
                <h1>
                    <a href="homepage.html">
                        <img src="assets/images/homepage_logo.svg" alt="CiMiäº¤å‹è«–å£‡">
                    </a>
                </h1>
            </div>
            <div class="search_bar" action="">
                <input type="search">
                <button>
                    <img src="assets/images/icon/nav_search.png" alt="æœå°‹">
                </button>
            </div>
            <div class="member_bar">
                <ul>
                    <li class="member_bar_phone"><a href="post.html"><img src="assets/images/icon/nav_post.png"
                                alt="ç™¼æ–‡"></a></li>
                    <li class="member_bar_phone"><img src="assets/images/icon/cart.png" alt="è³¼ç‰©è»Š"></li>
                    <li class="member_bar_phone"><a href="chat.html"><img src="assets/images/icon/nav_message.png"
                                alt="èŠå¤©å®¤"></a></li>
                    <li><img src="assets/images/icon/nav_member.png" alt="æœƒå“¡"></li>
                </ul>
            </div>
        </div>
    </header>

    <!-- è³¼ç‰©è»Šç‡ˆç®± -->
    <div id="shoppingApp">
        <div class="shopping_cart_light_box">
            <shopping-cart></shopping-cart>
        </div>
    </div>
    <script src="js/shop_cart.js"></script>
    <link rel="stylesheet" href="assets/css/shop_cart.css">
    <script>
        let mem_head = document.querySelector("img[alt='æœƒå“¡']");
        mem_head.addEventListener('click', check)

        function check() {
            // console.log(localStorage.getItem('login'));
            console.log(sessionStorage.getItem('login'));

            if (sessionStorage.getItem('login') == null) {
                location.href = 'login_new.html';

            } else {
                location.href = 'member_my_setup.html';
            }


        }
        if (sessionStorage.getItem('login') == 'success') {
            //ç™»å…¥çš„æ™‚å€™æŠŠé ­åƒæ›
            mem_head.src = sessionStorage.getItem('mem_head')
            let mem_link = document.querySelector("img[alt='æœƒå“¡']")
            // console.log(mem_link);
            // console.log(mem_link[3]);
            mem_link.href = 'member_my_setup.html';
        }

        // æœå°‹åˆ—è·³è½‰ç¶²é 
        (function search() {
            let searchbar = document.querySelector(".search_bar input[type='search']")
            let searchbtn = document.querySelector(".search_bar button")
            searchbtn.addEventListener("click", () => location.href = `search.html?search=${searchbar.value}`)
            searchbar.addEventListener("keydown", e => {
                if (e.which == 13 && !e.shiftKey) {
                    location.href = `search.html?search=${searchbar.value}`
                }
            })
        })()
    </script>

    <div class="content_area">
        <div class="sidebar_box">
            <aside class="sidebar">
                <nav>
                    <ul class="sidebar_list">
                        <li><a href="homepage.html"><img src="assets/images/icon/nav_home.svg" alt="é¦–é ">é¦–é </a>
                        </li>
                        <li><a href="billboard.html"><img src="assets/images/icon/nav_billboard.svg" alt="æ‰€æœ‰çœ‹ç‰ˆ">æ‰€æœ‰çœ‹ç‰ˆ</a>
                        </li>
                        <li><a href="product.html"><img src="assets/images/icon/nav_shop.svg" alt="å¥½ç‰©å•†åŸ">å¥½ç‰©å•†åŸ</a>
                        </li>
                        <li><a href="charts.html"><img src="assets/images/icon/nav_charts.svg" alt="å‰µä½œè€…æ’è¡Œæ¦œ">å‰µä½œè€…æ’è¡Œæ¦œ</a>
                        </li>
                        <li id="cimi_destiny"><a><img src="assets/images/icon/game_card.svg" alt="CiMi
                            Destiny">CiMi
                                Destiny</a></li>
                        <li class="nav_phone"><a href="member.html"><img src="assets/images/icon/nav_member.svg"
                                    alt="æœƒå“¡å°ˆå€">æœƒå“¡å°ˆå€</a>
                        </li>
                    </ul>
                </nav>
            </aside>
        </div>
        <script src="js/sidebar.js"></script>
        <main class="main_area" id="post">
            <div class="post_info">
                <div class="post_img">
                    <img src="./assets/images/blue_ball.png" v-show="show">

                    <img :src="memInfo.mem_head" v-show="login">
                </div>
                <div class="post_text">

                    <span class="post_name" v-show="show">
                        æœƒå“¡åç¨±
                    </span>

                    <span class="post_name" v-show="login">
                        {{memInfo.mem_name}}
                    </span>

                    <time>{{postDay}}</time>
                </div>
            </div>
            <form class="post" action="" @submit.prevent>
                <div class="select_billboard">
                    <select required :value="selectVal" @change="updateVal" id="board" v-model="selectVal">
                        <option v-for="board in boards" :value="board.billboard_no">{{board.billboard_name}}</option>
                    </select>
                </div>
                <input type="text" placeholder="æ¨™é¡Œ" required v-model="title">
                <textarea name="" id="" cols="100" rows="10" placeholder="å…§å®¹" required v-model="content"></textarea>
                <div class="post_file">
                    <label class="" id="" for="filename">
                        <div class="post_file_box">
                            <img src="assets/images/icon/Insert_picture.png" alt="">
                            <span>æ’å…¥åœ–ç‰‡</span>
                        </div>
                        <input type="file" id="filename" ref="fileInput" @change="uploadFile">
                    </label>

                </div>
                <div class="post_btn">
                    <button type="reset" class="btn-third" @click="backHome" @submit.prevent>å–æ¶ˆ</button>
                    <button type="submit" class="btn-secondary" @click="uploadData" @submit.prevent>æäº¤</button>
                </div>
                <img :src="image" id="img" style="display: none;"></img>
            </form>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.14/vue.common.dev.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script>
        new Vue({
            el: '#post',
            data: {
                title: "",
                content: "",
                selectVal: "å¥½è½éŸ³æ¨‚",
                image: "",
                boards: [],
                memInfo: [],
                icon: "",
                icons: ["ğŸ’–", "ğŸ¼", "ğŸ’„", "ğŸš´", "ğŸšŒ", "ğŸ§¥"],
                login: false,
                show: true
            },
            mounted() {

                if (sessionStorage.getItem('login') == null) {
                    swal("ç™»å…¥æ‰èƒ½ç™¼å¸ƒæ–‡ç« å–”! ç«‹å³å‰å¾€ç™»å…¥é é¢??", {
                            buttons: {

                                catch: {
                                    text: "å¦",
                                    value: "å¦",
                                },
                                default: {
                                    text: "æ˜¯",
                                    value: "æ˜¯",
                                },

                            },
                        })
                        .then((value) => {
                            switch (value) {

                                case "æ˜¯":
                                    location.href = "login_new.html"
                                    break;

                                case "å¦":
                                    location.href = "homepage.html"
                                    break;
                            }
                        });
                } else {
                    let params = new URLSearchParams();
                    params.append("mem_no", sessionStorage.getItem('mem_no'));
                    params.append("case", "getData");
                    axios.post('phps/post.php', params)
                        .then(res => {
                            console.log(res.data);
                            this.memInfo = res.data.mem
                            this.boards = res.data.board
                        })
                        .catch(err => {
                            // console.log(err);
                        });
                    this.show = false
                    this.login = true
                }

            },
            methods: {
                updateVal(v) {
                    let obj = document.getElementById('board')
                    //å–å¾—å€¼
                    this.selectVal = obj.value;
                    let num = parseInt(this.selectVal)

                    for (let i = 1; i < 7; i++) {
                        if (num == i) {
                            this.icon = this.icons[i - 1]
                        }
                    }




                },

                uploadFile() {
                    // æ‹¿å–æª”æ¡ˆ
                    let file = this.$refs.fileInput.files[0]
                    // console.log(file);

                    //å¯«é€²html
                    let readFile = new FileReader();
                    readFile.readAsDataURL(file);
                    readFile.addEventListener('load', this.loadImage);

                    //å‰µå»ºformdataç‰©ä»¶é€åˆ°å¾Œç«¯PHP
                    let form = new FormData()
                    form.append('file', file)
                    form.append('case', 'checkFile')
                    axios.post('phps/post.php', form).then(res => {
                        if (res.data != true) {
                            alert(res.data)
                        }
                    })
                },
                loadImage(e) {

                    this.image = e.target.result;
                    img.style.display = "block"

                },

                uploadData() {
                    // æ‹¿å–æª”æ¡ˆ
                    let file = this.$refs.fileInput.files[0]
                    // console.log(file);
                    // ç„¶å¾Œè‡ªå·±å»ºç«‹ä¸€å€‹è¡¨å–®ä¾†æ”¾è¦ä¸Šå‚³çš„è³‡æ–™
                    // ä¹Ÿå¯ä»¥é †ä¾¿å¸¶å…¶ä»–è³‡æ–™ä¾‹å¦‚ userId
                    let form = new FormData()
                    form.append('file', file)
                    form.append('case', 'insertData')
                    form.append("billboard_no", this.selectVal);
                    form.append("billboard_icon", this.icon);
                    form.append("article_title", this.title);
                    form.append("article_content", this.content);
                    form.append("case", "insertData");
                    form.append("mem_no", sessionStorage.getItem('mem_no'));

                    // ä¸Šå‚³åˆ°å¾Œç«¯ä¼ºæœå™¨
                    axios.post('phps/post.php', form).then(res => {
                        alert(res.data)
                        location.href = "homepage.html"
                    })
                },
                backHome() {
                    location.href = "homepage.html"
                }
            },
            computed: {
                postDay() {
                    let year = new Date().getFullYear()
                    let month = new Date().getMonth() + 1
                    let day = new Date().getDate()
                    return (year + '-' + month + '-' + day)
                }
            }
        })
    </script>
</body>

</html>