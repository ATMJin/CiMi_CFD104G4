<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁôºË°®ÊñáÁ´† | CiMi‰∫§ÂèãË´ñÂ£á</title>
    <link rel="icon" href="assets/images/logo.ico" type="image/x-icon">
    <link rel="stylesheet" href="assets/css/post.css">
    <link rel="stylesheet" href="assets/css/tabs.css">
</head>

<body>
    <header class="top_bar_box">
        <div class="top_bar">
            <div class="logo_box">
                <h1>
                    <a href="homepage.html">
                        <img src="assets/images/homepage_logo.svg" alt="CiMi‰∫§ÂèãË´ñÂ£á">
                    </a>
                </h1>
            </div>
            <div class="search_bar" action="">
                <input type="search">
                <button>
                    <img src="assets/images/icon/nav_search.png" alt="ÊêúÂ∞ã">
                </button>
            </div>
            <div class="member_bar">
                <ul>
                    <li class="member_bar_phone"><a href="post.html"><img src="assets/images/icon/nav_post.png"
                                alt="ÁôºÊñá"></a></li>
                    <li class="member_bar_phone"><img src="assets/images/icon/cart.png" alt="Ë≥ºÁâ©Ëªä"></li>
                    <li class="member_bar_phone"><a href="chat.html"><img src="assets/images/icon/nav_message.png"
                                alt="ËÅäÂ§©ÂÆ§"></a></li>
                    <li><img src="assets/images/icon/nav_member.png" alt="ÊúÉÂì°"></li>
                </ul>
            </div>
        </div>
    </header>

    <!-- Ë≥ºÁâ©ËªäÁáàÁÆ± -->
    <div id="shoppingApp">
        <div class="shopping_cart_light_box">
            <shopping-cart></shopping-cart>
        </div>
    </div>
    <script src="js/shop_cart.js"></script>
    <link rel="stylesheet" href="assets/css/shop_cart.css">
    <script>
        let mem_head = document.querySelector("img[alt='ÊúÉÂì°']");
        mem_head.addEventListener('click', check)

        function check() {
            // console.log(localStorage.getItem('login'));
            console.log(sessionStorage.getItem('login'));

            if (sessionStorage.getItem('login') == null) {
                location.href = 'login_new.html';

            } else {
                location.href = 'member_my_setup.html';
            }


        }
        if (sessionStorage.getItem('login') == 'success') {
            //ÁôªÂÖ•ÁöÑÊôÇÂÄôÊääÈ†≠ÂÉèÊèõ
            mem_head.src = sessionStorage.getItem('mem_head')
            let mem_link = document.querySelector("img[alt='ÊúÉÂì°']")
            // console.log(mem_link);
            // console.log(mem_link[3]);
            mem_link.href = 'member_my_setup.html';
        }

        // ÊêúÂ∞ãÂàóË∑≥ËΩâÁ∂≤È†Å
        (function search() {
            let searchbar = document.querySelector(".search_bar input[type='search']")
            let searchbtn = document.querySelector(".search_bar button")
            searchbtn.addEventListener("click", () => location.href = `search.html?search=${searchbar.value}`)
            searchbar.addEventListener("keydown", e => {
                if (e.which == 13 && !e.shiftKey) {
                    location.href = `search.html?search=${searchbar.value}`
                }
            })
        })()
    </script>

    <div class="content_area">
        <div class="sidebar_box">
            <aside class="sidebar">
                <nav>
                    <ul class="sidebar_list">
                        <li><a href="homepage.html"><img src="assets/images/icon/nav_home.svg" alt="È¶ñÈ†Å">È¶ñÈ†Å</a>
                        </li>
                        <li><a href="billboard.html"><img src="assets/images/icon/nav_billboard.svg" alt="ÊâÄÊúâÁúãÁâà">ÊâÄÊúâÁúãÁâà</a>
                        </li>
                        <li><a href="product.html"><img src="assets/images/icon/nav_shop.svg" alt="Â•ΩÁâ©ÂïÜÂüé">Â•ΩÁâ©ÂïÜÂüé</a>
                        </li>
                        <li><a href="charts.html"><img src="assets/images/icon/nav_charts.svg" alt="Ââµ‰ΩúËÄÖÊéíË°åÊ¶ú">Ââµ‰ΩúËÄÖÊéíË°åÊ¶ú</a>
                        </li>
                        <li id="cimi_destiny"><a><img src="assets/images/icon/game_card.svg" alt="CiMi
                            Destiny">CiMi
                                Destiny</a></li>
                        <li class="nav_phone"><a href="member.html"><img src="assets/images/icon/nav_member.svg"
                                    alt="ÊúÉÂì°Â∞àÂçÄ">ÊúÉÂì°Â∞àÂçÄ</a>
                        </li>
                    </ul>
                </nav>
            </aside>
        </div>
        <script src="js/sidebar.js"></script>
        <main class="main_area" id="post">
            <div class="post_info">
                <div class="post_img">
                    <!-- <img :src="https://picsum.photos/100/100/?random=11"> -->
                    <img :src="memInfo.mem_head">
                </div>
                <div class="post_text">
                    <span class="post_name">
                        {{memInfo.mem_name}}
                    </span>
                    <time>{{postDay}}</time>
                </div>
            </div>
            <form class="post" action="" @submit.prevent>
                <div class="select_billboard">
                    <select required :value="selectVal" @change="updateVal" id="board" v-model="selectVal">
                        <option v-for="board in boards" :value="board.billboard_no">{{board.billboard_name}}</option>
                    </select>
                </div>
                <input type="text" placeholder="Ê®ôÈ°å" required v-model="title">
                <textarea name="" id="" cols="100" rows="10" placeholder="ÂÖßÂÆπ" required v-model="content"></textarea>
                <div class="post_file">
                    <label class="" id="" for="filename">
                        <div class="post_file_box">
                            <img src="assets/images/icon/Insert_picture.png" alt="">
                            <span>ÊèíÂÖ•ÂúñÁâá</span>
                        </div>
                        <input type="file" id="filename" ref="fileInput" @change="uploadFile">
                    </label>

                </div>
                <div class="post_btn">
                    <button type="reset" class="btn-third" @click="backHome" @submit.prevent>ÂèñÊ∂à</button>
                    <button type="submit" class="btn-secondary" @click="uploadData" @submit.prevent>Êèê‰∫§</button>
                </div>
                <img :src="image" id="img" style="display: none;"></img>
            </form>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.14/vue.common.dev.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script>
        new Vue({
            el: '#post',
            data: {
                title: "",
                content: "",
                selectVal: "Â•ΩËÅΩÈü≥Ê®Ç",
                image: "",
                boards: [],
                memInfo: [],
                icon: "",
                icons:["üíñ", "üéº", "üíÑ", "üö¥", "üöå", "üß•"]
            },
            mounted() {
                let params = new URLSearchParams();
                params.append("mem_no", sessionStorage.getItem('mem_no'));
                params.append("case", "getData");
                axios.post('phps/post.php', params)
                    .then(res => {
                        // console.log(res.data);
                        this.memInfo = res.data.mem
                        this.boards = res.data.board
                    })
                    .catch(err => {
                        // console.log(err);
                    });
                if (sessionStorage.getItem('login') == null) {
                    swal("ÁôªÂÖ•ÊâçËÉΩÁôºÂ∏ÉÊñáÁ´†Âñî! Á´ãÂç≥ÂâçÂæÄÁôªÂÖ•È†ÅÈù¢??", {
                            buttons: {

                                catch: {
                                    text: "Âê¶",
                                    value: "Âê¶",
                                },
                                default: {
                                    text: "ÊòØ",
                                    value: "ÊòØ",
                                },

                            },
                        })
                        .then((value) => {
                            switch (value) {

                                case "ÊòØ":
                                    location.href = "login_new.html"
                                    break;

                                case "Âê¶":
                                    location.href = "homepage.html"
                                    break;
                            }
                        });
                }


            },
            methods: {
                updateVal(v) {
                    let obj = document.getElementById('board')
                    //ÂèñÂæóÂÄº
                    this.selectVal = obj.value;
                    let num = parseInt(this.selectVal)
                    
                    for(let i=1; i<7; i++){
                        if(num == i){
                            this.icon = this.icons[i-1]
                        }
                    }

                 


                },

                uploadFile() {
                    // ÊãøÂèñÊ™îÊ°à
                    let file = this.$refs.fileInput.files[0]
                    // console.log(file);

                    //ÂØ´ÈÄ≤html
                    let readFile = new FileReader();
                    readFile.readAsDataURL(file);
                    readFile.addEventListener('load', this.loadImage);

                    //ÂâµÂª∫formdataÁâ©‰ª∂ÈÄÅÂà∞ÂæåÁ´ØPHP
                    let form = new FormData()
                    form.append('file', file)
                    form.append('case', 'checkFile')
                    axios.post('phps/post.php', form).then(res => {
                        if (res.data != true) {
                            alert(res.data)
                        }
                    })
                },
                loadImage(e) {

                    this.image = e.target.result;
                    img.style.display = "block"

                },

                uploadData() {
                    // ÊãøÂèñÊ™îÊ°à
                    let file = this.$refs.fileInput.files[0]
                    // console.log(file);
                    // ÁÑ∂ÂæåËá™Â∑±Âª∫Á´ã‰∏ÄÂÄãË°®ÂñÆ‰æÜÊîæË¶Å‰∏äÂÇ≥ÁöÑË≥áÊñô
                    // ‰πüÂèØ‰ª•È†Ü‰æøÂ∏∂ÂÖ∂‰ªñË≥áÊñô‰æãÂ¶Ç userId
                    let form = new FormData()
                    form.append('file', file)
                    form.append('case', 'insertData')
                    form.append("billboard_no", this.selectVal);
                    form.append("billboard_icon", this.icon);
                    form.append("article_title", this.title);
                    form.append("article_content", this.content);
                    form.append("case", "insertData");
                    form.append("mem_no", sessionStorage.getItem('mem_no'));

                    // ‰∏äÂÇ≥Âà∞ÂæåÁ´Ø‰º∫ÊúçÂô®
                    axios.post('phps/post.php', form).then(res => {
                        alert(res.data)
                        location.href = "homepage.html"
                    })
                },
                backHome() {
                    location.href = "homepage.html"
                }
            },
            computed: {
                postDay() {
                    let year = new Date().getFullYear()
                    let month = new Date().getMonth() + 1
                    let day = new Date().getDate()
                    return (year + '-' + month + '-' + day)
                }
            }
        })
    </script>
</body>

</html>